<!DOCTYPE html>
<html>
<head>
	<meta charset="utf8">
	<title>NYC Pulse</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
	<script type="text/javascript"
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8LeyaDeV6VXi7os1k-XO_kATNyVkVDQw&sensor=false">
	</script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="{{
  url_for('static', filename='jquery.js') }}">\x3C/script>')</script>
	<script type="text/javascript">

		var data = {{ stops|safe }};
		console.log(data);

		var markers = [];
		// Initialize map
		function initialize() {
			var mapOptions = {
				center: new google.maps.LatLng(40.6700, -73.9400),
				zoom: 16
			};
			var map = new google.maps.Map(document.getElementById("map-canvas"),
				mapOptions);
					// Add stations to map
			console.log('adding stops');
			console.log(new Date().getTime());
			
			// Add markers to map
			var markers = addMarkers(data, map);
			tick();

		} // End of initialize

		google.maps.event.addDomListener(window, 'load', initialize);

		// Tick
		function tick() {
			console.log('calling tick');
			// console.log(markers);
			animate(markers);
			// clearInterval(t);
			var t = setTimeout('tick()', 10000);
		}

		
		// Add markers to map
		function addMarkers(data, map) {
			for (var i = 0; i < data.length; i++) {
				var stop = data[i];
				var myLatlng = new google.maps.LatLng(stop['lat'], stop['lon']);
				var marker = new google.maps.Marker({
					position: myLatlng,
					title: stop['name'],
					icon: '/static/train.png'
				});
				markers.push(marker);
				marker.setMap(map);	
			};
			return markers;
		}
	
		// Animation
		function animate(markers) {
			console.log('calling animate');
			// console.log(markers);
			for (var i = 0; i < markers.length; i++) {
				markers[i].setAnimation(google.maps.Animation.DROP);			
			};
		}
		

	</script>

</head>
<body>
	<div id="map-canvas"/>
</body>
</html>